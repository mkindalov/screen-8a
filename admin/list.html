<!DOCTYPE html>
<html>
<head>
<title>8a Screen - View entries</title>
<meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquerymobile/1.4.3/jquery.mobile.min.js"></script>
<script src="../assets/js/custom.js"></script>
<link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jquerymobile/1.4.3/jquery.mobile.min.css" />

</head>
<body>
  <div data-role="page">
    <div data-role="header">
      <a href="../index.html" data-icon="bars" class="ui-btn-left" data-ajax="false">Menu</a>
      <h1>Entries list</h1>
    </div>
    <div role="main" class="ui-content">
    <br/>
      <ul data-role="listview">
      </ul>
    </div>
    <div id="footer" data-role="footer"></div>
  </div>
</body>

<script type="text/javascript">
$(document).ready(function() {
	var apiKey = $.QueryString["apiKey"]
	$.ajax( { url: "https://api.mongolab.com/api/1/databases/workout/collections/coll1?s={date:-1}&apiKey=" + apiKey, type: "GET"})
	  .done(function( data ) {
		  var dateMap = {};
		  $.each(data, function(i, obj) {
			  var key = obj.date;
			  if (!dateMap[key]) {
				  dateMap[key] = [];
			    }
			  dateMap[key].push(obj);
		  });
		  $.each(dateMap, function(key, dataList) {
			  var li = $('<li data-role="list-divider">' +dateToString(new Date(key)) + '<span class="ui-li-count">' + dataList.length + '</span></li>');
			  $('ul').append(li);
			  $.each(dataList, function(i, obj) {
    			  var li = $('<li><a data-ajax="false" href="details.html?id=' + obj._id.$oid + '&apiKey=' + $.QueryString["apiKey"] + '"></a></li>');
    			  $('ul').append(li);
    			  jQuery.each(obj, function(key, val) {
    				  if (key=="_id") {return};
    				  if (key=="tag") {
        				  li.find('a').prepend($('<h2>Activity: ' + val + '</h2>'));
        				  return
        				}
    				  if (key=="date") {
        				  return
        				}
    				  li.find('a').append($('<p style="white-space: normal" ><strong>' + key + ':</strong> ' + val + '</p>'));
    			  });
    			});
		 	});
		  $('ul').listview( "refresh" );
	    });
	});
</script>
</html>